# 画面テキスト監視システム

高精度OCRによるリアルタイム画面テキスト監視システム（完成版）

## ✨ 主な機能

### 🎯 完全実装済み機能
- **半透明領域選択UI**: 画面全体に半透明オーバーレイを表示し、視覚的に領域を選択
- **高精度OCR**: Tesseract + LSTM エンジンによる日本語テキスト認識
- **リアルタイム監視**: 500ms間隔での画面監視とテキスト変化検出
- **詳細な差分検出**: 前回認識結果との行レベル差分抽出（追加・削除行の特定）
- **自動監視停止**: 領域選択時に自動的に監視を停止
- **Tauri GUI**: 軽量デスクトップアプリケーション（完全日本語対応）

### 🔧 OCR精度向上機能
- **高度な画像前処理**:
  - ヒストグラム均等化によるコントラスト強化
  - メディアンフィルタによるノイズ除去
  - アンシャープマスクによるシャープネス強化
  - OCR向け高解像度化（1000px以上）
- **複数回認識**: 3回認識を実行し、最頻出結果を採用
- **最適化されたTesseract設定**: LSTM エンジン + ページセグメンテーション最適化

## 🚀 使い方

### 1. アプリケーション起動
```bash
cargo run --bin main
```

### 2. 領域選択（半透明UI）
- 「領域を選択」ボタンをクリック
- 画面全体が半透明の暗いオーバーレイで表示
- マウスでドラッグして監視領域を選択
- 選択範囲は明るい緑の枠で表示
- 「選択を確定」ボタンまたはEnterキーで確定

### 3. 監視開始・制御
- 「監視を開始」ボタンで500ms間隔の監視開始
- 「監視を停止」ボタンで監視停止
- 領域選択時は自動的に監視が停止

### 4. リアルタイム結果確認
- **履歴表示**: 認識結果がリアルタイムで履歴に表示
- **イベント分類**: 新規・変更・クリア・差分・エラーの色分け表示
- **差分詳細**: 追加された行と削除された行を個別に表示

## 🛠 必要な環境

### システム要件
- **Rust**: 1.70以上
- **Tesseract OCR**: 4.0以上（日本語言語パック含む）
- **対象OS**: macOS（テスト完了）、Windows・Linux（対応済み）

### Tesseractのインストール

#### macOS
```bash
brew install tesseract tesseract-lang
```

#### Ubuntu/Debian
```bash
sudo apt-get install tesseract-ocr tesseract-ocr-jpn
```

#### Windows
[Tesseract公式サイト](https://github.com/UB-Mannheim/tesseract/wiki)からインストーラーをダウンロードし、日本語データを含めてインストール

## 📦 ビルド・実行

### 開発用ビルド
```bash
# プロジェクトディレクトリで実行
cargo build --bin main

# ログ付きで実行（デバッグ用）
RUST_LOG=info cargo run --bin main
```

### リリース用ビルド
```bash
cargo build --release --bin main
cargo run --release --bin main
```

## 🎮 実用例

### YouTubeライブチャット監視
1. YouTubeライブ配信を開く
2. チャット欄を領域選択
3. 監視開始で新しいチャットメッセージを自動検出

### ゲーム画面監視
- ゲーム内テキスト・ダイアログの変化を検出
- スコア・ステータス情報のリアルタイム監視

### デスクトップアプリ監視
- 通知・メッセージの自動検出
- アプリケーション状態の変化監視

## 🏗 技術仕様

### アーキテクチャ
- **言語**: Rust
- **GUI**: Tauri (HTML/CSS/JavaScript)
- **画面キャプチャ**: screenshots crate
- **画像処理**: image crate（高度な前処理付き）
- **OCR**: tesseract crate（LSTM エンジン最適化）
- **非同期処理**: tokio

### パフォーマンス
- **監視間隔**: 500ms（調整可能）
- **OCR精度**: 高精度（複数回認識 + 投票システム）
- **メモリ効率**: 画像バッファの適切な管理
- **安定性**: Bus Error回避済み

## 🐛 トラブルシューティング

### よくある問題と解決法

1. **Tesseractエラー**
   ```
   Error: Tesseractの初期化に失敗しました
   ```
   - `tesseract --version`で動作確認
   - 日本語データ: `brew install tesseract-lang` (macOS)

2. **画面キャプチャ権限エラー（macOS）**
   - システム環境設定 > プライバシー > 画面収録
   - ターミナルに権限を付与

3. **ビルドエラー**
   ```bash
   cargo clean && cargo build
   ```

## 📋 完成機能一覧

### ✅ 基本機能
- [x] 半透明領域選択インターフェース
- [x] 高精度日本語OCR
- [x] リアルタイム監視・制御
- [x] 詳細な差分検出
- [x] 自動監視停止

### ✅ UI/UX
- [x] Tauri デスクトップアプリ
- [x] 完全日本語対応
- [x] リアルタイム履歴表示
- [x] 視覚的なイベント分類

### ✅ OCR最適化
- [x] 高度な画像前処理パイプライン
- [x] 複数回認識による精度向上
- [x] LSTM エンジン最適化
- [x] Bus Error回避

## 📁 プロジェクト構成

```
src/
├── main.rs          # Tauriメインアプリケーション
├── capture.rs       # 画面キャプチャ機能
├── ocr.rs          # 高精度OCR実装
└── monitor.rs      # 監視・差分検出
dist/
├── index.html      # メインUI
└── region_selector.html  # 領域選択UI
```

## 📄 ライセンス

MIT License