# 画面テキスト監視システム

## プロジェクト概要
リアルタイム画面テキスト監視システム（完成版）。
画面上の指定領域を監視し、テキストの変化を検出・通知するデスクトップアプリケーション。

## 注意事項

思考は英語で行い、返答は日本語で返すこと。
コードには日本語のコメントを逐次入れること。

## 完成した機能

### ✅ 基本機能（完成）
- **半透明領域選択UI**: 画面全体に半透明オーバーレイを表示し、視覚的に領域を選択
- **高精度OCR**: Tesseract + LSTM エンジンによる日本語テキスト認識
- **リアルタイム監視**: 500ms間隔での画面監視とテキスト変化検出
- **差分検出**: 前回認識結果との詳細な差分抽出（追加・削除行の特定）
- **自動監視停止**: 領域選択時に自動的に監視を停止

### ✅ OCR精度向上機能（完成）
- **高度な画像前処理**:
  - ヒストグラム均等化によるコントラスト強化
  - メディアンフィルタによるノイズ除去
  - アンシャープマスクによるシャープネス強化
  - OCR向け高解像度化（1000px以上）
- **複数回認識**: 3回認識を実行し、最頻出結果を採用
- **最適化されたTesseract設定**:
  - LSTM OCRエンジンモード（高精度）
  - ページセグメンテーションモード6（均一ブロック用）
  - 日本語認識の最適化設定

### ✅ GUI機能（完成）
- **Tauri ベースのクロスプラットフォームアプリ**: HTML/CSS/JavaScript UI
- **日本語対応**: 完全な日本語表示とメッセージ
- **リアルタイム履歴表示**: テキスト変化の履歴をリアルタイム表示
- **視覚的なイベント分類**: 新規・変更・クリア・差分・エラーの色分け表示

## 技術仕様

### 実装済みアーキテクチャ
1. **画面キャプチャ**: `screenshots` crate による高速キャプチャ
2. **画像前処理**: `image` crate による高度な画像処理パイプライン
3. **OCR エンジン**: `tesseract` + LSTM による高精度テキスト認識
4. **差分検出**: 行レベルの詳細な変化検出アルゴリズム
5. **GUI フレームワーク**: Tauri による軽量デスクトップアプリ

### 採用技術スタック
- **言語**: Rust 1.70+
- **画面キャプチャ**: `screenshots = "0.8"`
- **画像処理**: `image = "0.24"` (高度な前処理機能付き)
- **OCR**: `tesseract = "0.15"` (LSTM エンジン最適化済み)
- **GUI**: `tauri = "1.5"` (HTML/CSS/JavaScript UI)
- **非同期処理**: `tokio = "1.35"` (軽量版、rt+macros)
- **エラーハンドリング**: `anyhow = "1.0"`
- **シリアライゼーション**: `serde = "1.0"`

### パフォーマンス特性
- **監視間隔**: 500ms（調整可能）
- **OCR精度**: 高精度（複数回認識 + 投票システム）
- **メモリ効率**: 画像バッファの適切な管理とクリーンアップ
- **CPU使用率**: OCR処理の最適化済み（Bus Error回避含む）
- **レスポンス性**: リアルタイム差分検出とUI更新

## 実装済みモジュール

### src/main.rs
- Tauriベースのメインアプリケーション
- 領域選択・監視開始・停止のコマンド実装
- 監視中の自動停止機能
- テキスト変化イベントの処理とUI通知

### src/capture.rs
- `screenshots` crateを使用した画面キャプチャ機能
- 指定領域の高速スクリーンショット取得
- 座標とサイズのバリデーション

### src/ocr.rs（高精度OCR実装）
- Tesseract + LSTM エンジンによる日本語OCR
- 高度な画像前処理パイプライン:
  - ヒストグラム均等化
  - メディアンフィルタによるノイズ除去
  - アンシャープマスクによるシャープネス強化
- 複数回認識による精度向上（3回認識 + 投票システム）
- Bus Error回避のための安全な実装

### src/monitor.rs
- 非同期監視とテキスト差分検出
- 行レベルの詳細な変化検出アルゴリズム
- 追加・削除行の特定機能

### GUI実装
- **dist/index.html**: メインUI（日本語対応）
- **dist/region_selector.html**: 半透明領域選択UI
- リアルタイム履歴表示と視覚的なイベント分類

## 使用例

### YouTubeチャット監視
1. アプリケーションを起動
2. 「領域を選択」でYouTubeチャット欄を選択
3. 「監視を開始」でリアルタイム監視開始
4. 新しいチャットメッセージが自動検出・表示

### その他の用途
- ゲーム画面のテキスト監視
- ライブ配信のテキスト検出
- デスクトップアプリケーションの状態監視

## 開発環境・実行方法

### 必要なシステム要件
- **Rust**: 1.70以上
- **Tesseract OCR**: システムにインストール済み（日本語言語パック含む）
- **対象OS**: macOS（開発・テスト完了）、Windows 10/11・Linux（対応予定）

### ビルド・実行コマンド

```bash
# プロジェクトのビルド
cargo build --bin main

# アプリケーションの実行
cargo run --bin main

# ログ付きで実行（デバッグ用）
RUST_LOG=info cargo run --bin main

# リリースビルド（最適化済み）
cargo build --release --bin main
```

### 依存関係の詳細

```toml
[dependencies]
tauri = { version = "1.5", features = ["api-all"] }
screenshots = "0.8"
image = "0.24"
tesseract = "0.15"
tokio = { version = "1.35", features = ["rt", "macros"] }
anyhow = "1.0"
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
log = "0.4"
env_logger = "0.11"
```

### トラブルシューティング

1. **Tesseractエラー**: `brew install tesseract tesseract-lang` (macOS)
2. **ビルドエラー**: `cargo clean && cargo build`
3. **実行時エラー**: ログレベルを上げて原因調査 `RUST_LOG=debug cargo run --bin main`

## プロジェクト完成状況

### ✅ 完全実装済み機能
- **基本機能**: 画面キャプチャ・領域選択・監視制御
- **高精度OCR**: 日本語テキスト認識（LSTM + 画像前処理）
- **差分検出**: 詳細な変化検出（行レベル追加・削除特定）
- **GUI**: Tauri ベースのデスクトップアプリ（日本語対応）
- **半透明UI**: 視覚的な領域選択インターフェース
- **自動制御**: 領域選択時の監視自動停止

### 🎯 実用可能な用途
- YouTubeライブチャット監視
- ゲーム画面テキスト検出
- デスクトップアプリケーション状態監視
- ライブ配信コメント取得